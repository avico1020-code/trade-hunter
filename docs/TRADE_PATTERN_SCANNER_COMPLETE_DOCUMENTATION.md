# ×“×•×— ××¤×•×¨×˜: ××¢×¨×›×ª ×¡×¨×™×§×ª ×ª×‘× ×™×•×ª ××¡×—×¨ (Trade Pattern Scanner System)

**×ª××¨×™×š ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:** ×“×¦××‘×¨ 2024  
**×’×¨×¡×”:** 1.0  
**×¡×˜×˜×•×¡:** Production Ready

---

## ğŸ“‹ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [×¡×§×™×¨×” ×›×œ×œ×™×ª](#×¡×§×™×¨×”-×›×œ×œ×™×ª)
2. [××¨×›×™×˜×§×˜×•×¨×” ×›×œ×œ×™×ª](#××¨×›×™×˜×§×˜×•×¨×”-×›×œ×œ×™×ª)
3. [×¨×›×™×‘×™× ×¢×™×§×¨×™×™×](#×¨×›×™×‘×™×-×¢×™×§×¨×™×™×)
4. [×ª×”×œ×™×š ×”×¡×¨×™×§×”](#×ª×”×œ×™×š-×”×¡×¨×™×§×”)
5. [×ª×›×•× ×•×ª ××ª×§×“××•×ª](#×ª×›×•× ×•×ª-××ª×§×“××•×ª)
6. [××™× ×˜×’×¨×¦×™×•×ª](#××™× ×˜×’×¨×¦×™×•×ª)
7. [××¦×‘ × ×•×›×—×™ ×•×ª×›× ×•×Ÿ ×¢×ª×™×“×™](#××¦×‘-× ×•×›×—×™-×•×ª×›× ×•×Ÿ-×¢×ª×™×“×™)
8. [×“×•×’×××•×ª ×©×™××•×©](#×“×•×’×××•×ª-×©×™××•×©)

---

## ğŸ¯ ×¡×§×™×¨×” ×›×œ×œ×™×ª

### ××˜×¨×ª ×”××¢×¨×›×ª

**Trade Pattern Scanner** ×”×™× ×©×›×‘×ª ×‘×™× ×™×™× ×‘××¢×¨×›×ª ×”××¡×—×¨ ×”××œ×’×•×¨×™×ª××™×ª, ×”××—×‘×¨×ª ×‘×™×Ÿ:
- **Master Scoring System** (××¢×¨×›×ª ×”× ×™×§×•×“) - ×‘×•×—×¨×ª ×× ×™×•×ª ××•×‘×™×œ×•×ª
- **Execution Engine** (×× ×•×¢ ×”×‘×™×¦×•×¢) - ××‘×¦×¢ ××ª ×”×¢×¡×§××•×ª ×‘×¤×•×¢×œ

×”××¢×¨×›×ª ××—×¨××™×ª ×œ:
1. ×¡×¨×™×§×ª ×× ×™×•×ª ×‘×¢×œ×•×ª ×¦×™×•×Ÿ ×’×‘×•×”
2. ×–×™×”×•×™ ×ª×‘× ×™×•×ª ××¡×—×¨ (Double Top, Gap Up, Breakout ×•×›×•')
3. ××™××•×ª ×”×ª×‘× ×™×•×ª ××•×œ × ×ª×•× ×™× ×‘×–××Ÿ ×××ª
4. ×”×¢×‘×¨×ª ×”×ª×¨××•×ª ×œ×× ×•×¢ ×”×‘×™×¦×•×¢

### ××™×§×•× ×‘××¢×¨×›×ª ×”×›×•×œ×œ×ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ××¢×¨×›×ª ×”××¡×—×¨ ×”××œ×’×•×¨×™×ª××™×ª                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Master       â”‚â”€â”€â”€â–¶â”‚ Trade Pattern    â”‚â”€â”€â”€â–¶â”‚ Execution    â”‚
â”‚ Scoring      â”‚    â”‚ Scanner          â”‚    â”‚ Engine       â”‚
â”‚ System       â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚              â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚ â€¢ Technical  â”‚    â”‚ â€¢ Pattern        â”‚    â”‚ â€¢ Trade      â”‚
â”‚ â€¢ News       â”‚    â”‚   Detection      â”‚    â”‚   Execution  â”‚
â”‚ â€¢ Macro      â”‚    â”‚ â€¢ Real-time      â”‚    â”‚ â€¢ Risk Mgmt  â”‚
â”‚ â€¢ Sector     â”‚    â”‚   Scanning       â”‚    â”‚ â€¢ Position   â”‚
â”‚ â€¢ Options    â”‚    â”‚ â€¢ Direction      â”‚    â”‚   Sizing     â”‚
â”‚ â€¢ Micro      â”‚    â”‚   Filtering      â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×” ×›×œ×œ×™×ª

### ×¢×§×¨×•× ×•×ª ×¢×™×¦×•×‘

1. **Modular Design** - ×›×œ ××¡×˜×¨×˜×’×™×” ×”×™× ××•×“×•×œ ×¢×¦×××™
2. **Interface-Based** - ×××©×§ ××—×™×“ (`IPatternStrategy`) ×œ×›×œ ×”××¡×˜×¨×˜×’×™×•×ª
3. **Real-time Processing** - ×¢×™×‘×•×“ ×‘×–××Ÿ ×××ª ×¢× subscriptions
4. **Direction-Aware** - ×¡×™× ×•×Ÿ ××¡×˜×¨×˜×’×™×•×ª ×œ×¤×™ ×›×™×•×•×Ÿ ×”××¡×—×¨
5. **Anti-Spam Protection** - ×× ×™×¢×ª ×˜×¨×™×’×¨×™× ×›×¤×•×œ×™×

### ××‘× ×” ×”×§×‘×¦×™×

```
lib/
â”œâ”€â”€ scanner/
â”‚   â””â”€â”€ trade-pattern-scanner.ts    # ××—×œ×§×ª ×”×¡×•×¨×§ ×”×¨××©×™×ª
â””â”€â”€ strategies/
    â”œâ”€â”€ double-top.ts                # ××¡×˜×¨×˜×’×™×™×ª Double Top
    â”œâ”€â”€ gap-up.ts                    # ××¡×˜×¨×˜×’×™×™×ª Gap Up (×œ×¢×ª×™×“)
    â””â”€â”€ breakout.ts                  # ××¡×˜×¨×˜×’×™×™×ª Breakout (×œ×¢×ª×™×“)
```

---

## ğŸ”§ ×¨×›×™×‘×™× ×¢×™×§×¨×™×™×

### 1. TradePatternScanner Class

**××™×§×•×:** `lib/scanner/trade-pattern-scanner.ts`

**×ª×¤×§×™×“×™×:**
- × ×™×”×•×œ ×”×¡×¨×™×§×” ×”×¨××©×™×ª
- ×§×™×©×•×¨ ×‘×™×Ÿ Master Scoring ×œ-Real-time Data
- ×”×¨×¦×ª ×–×™×”×•×™ ×ª×‘× ×™×•×ª ×¢×œ ×›×œ ×¢×“×›×•×Ÿ
- × ×™×”×•×œ Debounce ×•×× ×˜×™-×¡×¤××
- ×¡×™× ×•×Ÿ ×œ×¤×™ ×›×™×•×•×Ÿ (LONG/SHORT)

**××‘× ×” ×”×§×œ××¡:**

```typescript
export class TradePatternScanner {
  private lastDetection: Record<string, number> = {}; // Anti-spam tracking
  
  constructor(
    private masterClient: MasterScoringClient,      // ××§×•×¨: ×¨×©×™××ª ×× ×™×•×ª ××•×‘×™×œ×•×ª
    private dataClient: RealTimeDataClient,         // ××§×•×¨: × ×ª×•× ×™× ×‘×–××Ÿ ×××ª
    private strategies: IPatternStrategy[],         // ×¨×©×™××ª ××¡×˜×¨×˜×’×™×•×ª
    private config: TradePatternScannerConfig,      // ×”×’×“×¨×•×ª ×”×¡×•×¨×§
    private onPatternFound: OnPatternFoundHandler,  // callback ×œ×”×ª×¨××•×ª
    private logger?: ScannerLogger                  // ××¢×¨×›×ª ×œ×•×’×™× ×’
  )
}
```

### 2. IPatternStrategy Interface

**×ª×¤×§×™×“:** ×××©×§ ××—×™×“ ×œ×›×œ ××¡×˜×¨×˜×’×™×•×ª ×–×™×”×•×™ ×ª×‘× ×™×•×ª

**××‘× ×”:**

```typescript
export interface IPatternStrategy {
  name: string;              // "DOUBLE_TOP", "GAP_UP", etc.
  direction: "LONG" | "SHORT" | "BOTH";
  
  detectPattern(
    candles: Candle[],
    indicators?: IndicatorSnapshot
  ): PatternDetectionResult;
}
```

**×—×•×‘×” ×¢×œ ×›×œ ××¡×˜×¨×˜×’×™×”:**
- ×œ×××© ××ª ×”×××©×§ ×‘××œ×•××•
- ×œ×”×—×–×™×¨ `patternFound: boolean`
- ×œ×”×’×“×™×¨ ×›×™×•×•×Ÿ ××¡×—×¨ (LONG/SHORT/BOTH)
- ×œ×˜×¤×œ ×‘×©×’×™××•×ª ×¤× ×™××™×ª

### 3. RealTimeDataClient Interface

**×ª×¤×§×™×“:** ×××©×§ ×œ× ×ª×•× ×™× ×‘×–××Ÿ ×××ª

**××‘× ×”:**

```typescript
export interface RealTimeDataClient {
  subscribeCandles(
    symbol: string,
    onUpdate: (candles: Candle[], indicators: IndicatorSnapshot) => void
  ): void;
}
```

**×“×¨×™×©×•×ª:**
- ×—×™×‘×•×¨ ×œ-IBKR TWS/Gateway
- ×¢×“×›×•× ×™× ×¨×¦×™×¤×™× ×©×œ candles ×•××™× ×“×™×§×˜×•×¨×™×
- × ×™×”×•×œ subscriptions ×œ×›×œ ×× ×™×”

### 4. MasterScoringClient Interface

**×ª×¤×§×™×“:** ×××©×§ ×œ××¢×¨×›×ª ×”× ×™×§×•×“

**××‘× ×”:**

```typescript
export interface MasterScoringClient {
  getTopSymbols(minScore: number): Promise<MasterSymbolInfo[]>;
}
```

**×”×—×–×¨ × ×ª×•× ×™×:**

```typescript
interface MasterSymbolInfo {
  symbol: string;
  direction: "LONG" | "SHORT";
  masterScore: number;
  moduleScores: Record<string, number>; // Technical, News, Macro, etc.
}
```

---

## ğŸ”„ ×ª×”×œ×™×š ×”×¡×¨×™×§×”

### ×©×œ×‘ 1: ××ª×—×•×œ ×”×¡×•×¨×§

```
1. TradePatternScanner ××•×¤×¢×œ
   â†“
2. ×§×¨×™××” ×œ-masterClient.getTopSymbols(minMasterScore)
   â†“
3. ×§×‘×œ×ª ×¨×©×™××ª ×× ×™×•×ª ××•×‘×™×œ×•×ª (×œ×“×•×’××”: 20 ×× ×™×•×ª ×¢× ×¦×™×•×Ÿ â‰¥ 6.0)
   â†“
4. ×¡×™× ×•×Ÿ ×œ×¤×™ maxSymbolsToScan (×× ××•×’×“×¨)
```

### ×©×œ×‘ 2: ×”×¨×©××” ×œ× ×ª×•× ×™× ×‘×–××Ÿ ×××ª

```
×¢×‘×•×¨ ×›×œ ×× ×™×” ×‘×¨×©×™××”:
  1. ×§×¨×™××” ×œ-dataClient.subscribeCandles(symbol, onUpdate)
  2. ×¤×ª×™×—×ª subscription ×œ× ×¨×•×ª ×•××™× ×“×™×§×˜×•×¨×™×
  3. ×©××™×¨×ª MasterSymbolInfo ×œ×”×§×©×¨
```

### ×©×œ×‘ 3: ×¢×™×‘×•×“ ×¢×“×›×•× ×™×

```
×¢×œ ×›×œ ×¢×“×›×•×Ÿ × ×ª×•× ×™× ×—×“×©:
  â†“
1. ××™××•×ª ××‘× ×” ×”× ×¨×•×ª (validateCandles)
  â†“
2. ×‘×“×™×§×ª × ×¨ ×¡×’×•×¨ (×× requireClosedCandle=true)
  â†“
3. ×œ×•×œ××” ×¢×œ ×›×œ ×”××¡×˜×¨×˜×’×™×•×ª:
   â”œâ”€ ×‘×“×™×§×ª ×›×™×•×•×Ÿ (isStrategyAllowedForSymbol)
   â”œâ”€ ×”×¨×¦×ª detectPattern()
   â”œâ”€ ×‘×“×™×§×ª Anti-spam (shouldEmit)
   â””â”€ ×× × ××¦× ×ª×‘× ×™×ª â†’ ×™×¦×™×¨×ª PatternFoundEvent
```

### ×©×œ×‘ 4: ×”×¢×‘×¨×ª ×”×ª×¨××•×ª

```
PatternFoundEvent ×›×•×œ×œ:
  â€¢ symbol: ×× ×™×”
  â€¢ strategyName: ×©× ×”××¡×˜×¨×˜×’×™×”
  â€¢ strategyDirection: ×›×™×•×•×Ÿ ×”××¡×˜×¨×˜×’×™×”
  â€¢ patternState: ××¦×‘ ×”×ª×‘× ×™×ª (entryPrice, stopLoss, metadata)
  â€¢ master: MasterSymbolInfo (×¦×™×•×Ÿ ×•×›×•×•×Ÿ)
  â€¢ detectedAt: timestamp

  â†“
×§×¨×™××” ×œ-onPatternFound(event)
  â†“
×”×¢×‘×¨×” ×œ-Execution Engine
```

### ×“×™××’×¨××ª ×–×¨×™××” ××œ××”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     START SCANNER                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  getTopSymbols(minMasterScore)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   [AAPL, GOOGL, MSFT, ...]      â”‚
        â”‚   (×¨×©×™××ª ×× ×™×•×ª ××“×•×¨×’×•×ª)          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AAPL    â”‚      â”‚ GOOGL   â”‚      â”‚ MSFT    â”‚
  â”‚ LONG    â”‚      â”‚ SHORT   â”‚      â”‚ LONG    â”‚
  â”‚ Score:  â”‚      â”‚ Score:  â”‚      â”‚ Score:  â”‚
  â”‚ 7.5     â”‚      â”‚ 6.8     â”‚      â”‚ 8.2     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  subscribeCandles(symbol, onUpdate)        â”‚
  â”‚  (Real-time subscription ×œ×›×œ ×× ×™×”)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ New Candle   â”‚  â”‚ New Candle   â”‚  â”‚ New Candle   â”‚
  â”‚ Update       â”‚  â”‚ Update       â”‚  â”‚ Update       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚         For Each Strategy:                 â”‚
  â”‚  1. Check Direction Filter                 â”‚
  â”‚  2. Run detectPattern()                    â”‚
  â”‚  3. Check Anti-spam                        â”‚
  â”‚  4. If found â†’ Emit Event                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     PatternFoundEvent â†’ Execution Engine   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ ×ª×›×•× ×•×ª ××ª×§×“××•×ª

### 1. Direction-Aware Filtering

**××˜×¨×”:** ×œ×× ×•×¢ ×”×¨×¦×ª ××¡×˜×¨×˜×’×™×•×ª ×©×œ× ××ª××™××•×ª ×œ×›×™×•×•×Ÿ ×”××¡×—×¨

**××•×¤×Ÿ ×¤×¢×•×œ×”:**

```typescript
// ×× Master Scoring ×§×‘×¢ LONG:
- ×¨×§ ××¡×˜×¨×˜×’×™×•×ª LONG ××• BOTH ×™×¨×¦×•
- ××¡×˜×¨×˜×’×™×•×ª SHORT ×™×™×“×œ×’×•

// ×× Master Scoring ×§×‘×¢ SHORT:
- ×¨×§ ××¡×˜×¨×˜×’×™×•×ª SHORT ××• BOTH ×™×¨×¦×•
- ××¡×˜×¨×˜×’×™×•×ª LONG ×™×™×“×œ×’×•
```

**×™×ª×¨×•× ×•×ª:**
- ×—×™×¡×›×•×Ÿ ×‘××©××‘×™×
- ×ª××™××•×ª ×’×‘×•×”×” ×™×•×ª×¨ ×‘×™×Ÿ ×ª×‘× ×™×ª ×œ×›×™×•×•×Ÿ
- ×”×§×˜× ×ª false positives

**×”×¤×¢×œ×”:**
```typescript
config: {
  enableDirectionFilter: true  // ×‘×¨×™×¨×ª ××—×“×œ: false
}
```

### 2. Debounce (Anti-Spam) System

**××˜×¨×”:** ×œ×× ×•×¢ ×˜×¨×™×’×¨×™× ××¨×•×‘×™× ×××•×ª×” ×ª×‘× ×™×ª

**××•×¤×Ÿ ×¤×¢×•×œ×”:**

```typescript
// ××¤×ª×—: "AAPL::DOUBLE_TOP"
// ×¢×¨×š: timestamp ×©×œ ×–×™×”×•×™ ××—×¨×•×Ÿ

// ×œ×¤× ×™ ×˜×¨×™×’×¨:
1. ×‘×“×™×§×”: ×”×× ×—×œ×¤×• debounceMs ××™×œ×™-×©× ×™×•×ª ××”×˜×™×’×¨ ×”××—×¨×•×Ÿ?
2. ×× ×›×Ÿ â†’ ××•×ª×¨ ×œ×˜×™×’×¨
3. ×× ×œ× â†’ ×˜×¨×™×’×¨ × ×—×¡×
```

**×‘×¨×™×¨×ª ××—×“×œ:** 2000ms (2 ×©× ×™×•×ª)

**×”×ª×××”:**
```typescript
config: {
  debounceMs: 3000  // 3 ×©× ×™×•×ª
}
```

### 3. Closed Candle Protection

**××˜×¨×”:** ×œ×”×¨×™×¥ ×–×™×”×•×™ ×¨×§ ×¢×œ × ×¨×•×ª ×¡×’×•×¨×™× (××•××œ×¥ ×œ-Price Action)

**××•×¤×Ÿ ×¤×¢×•×œ×”:**

```typescript
// ×‘×“×™×§×ª isClosed ×¢×œ ×”× ×¨ ×”××—×¨×•×Ÿ
if (requireClosedCandle && !hasClosedLastCandle(candles)) {
  return; // ××“×œ×’×™× ×¢×œ ×”×¢×“×›×•×Ÿ
}
```

**×©×™××•×©:**
- ×ª×‘× ×™×•×ª ×”××‘×•×¡×¡×•×ª ×¢×œ Price Action
- ×ª×‘× ×™×•×ª ×”×“×•×¨×©×•×ª ××™×©×•×¨ ××œ×
- ××¡×—×¨ ×©××¨× ×™ ×™×•×ª×¨

**×”×¤×¢×œ×”:**
```typescript
config: {
  requireClosedCandle: true
}
```

### 4. Validation Layers

**×¨××•×ª ××™××•×ª:**

1. **Symbol Info Validation**
   - ×‘×“×™×§×ª ××‘× ×” MasterSymbolInfo
   - ××™××•×ª symbol, direction, masterScore
   
2. **Candles Validation**
   - ×‘×“×™×§×ª ××‘× ×” × ×¨×•×ª (OHLCV)
   - ××™××•×ª ×¢×¨×›×™× ×ª×§×™× ×™×
   - ×‘×“×™×§×ª ×œ×•×’×™×§×” (high â‰¥ low, ×•×›×•')

3. **Pattern Result Validation**
   - ××™××•×ª ××‘× ×” PatternDetectionResult
   - ×‘×“×™×§×ª patternFound

**×ª×•×¦××”:** ××¢×¨×›×ª ×™×¦×™×‘×” ×™×•×ª×¨, ×¤×—×•×ª crashes

### 5. Historical Scanning (Backtest Mode)

**×©×™××•×©:** ×¡×¨×™×§×” ×¢×œ × ×ª×•× ×™× ×”×™×¡×˜×•×¨×™×™× ×œ×‘×™×¦×•×¢ backtest

**××˜×•×“×•×ª:**

```typescript
// ×¡×¨×™×§×” ×œ×× ×™×” ××—×ª
scanHistorical(
  symbol: string,
  candles: Candle[],
  indicators?: IndicatorSnapshot,
  masterOverride?: Partial<MasterSymbolInfo>
): Promise<PatternFoundEvent[]>

// ×¡×¨×™×§×” ××¨×•×‘×ª ×× ×™×•×ª
scanHistoricalBatch(
  batch: Array<{symbol, candles, indicators}>,
  masterOverrides?: Record<string, Partial<MasterSymbolInfo>>
): Promise<PatternFoundEvent[]>
```

**×”×‘×“×œ×™× ×-Real-time Mode:**
- âŒ ×œ× ××©×ª××© ×‘-debounce
- âŒ ×œ× ××©×ª××© ×‘-direction filtering
- âŒ ×œ× ×“×•×¨×© × ×¨ ×¡×’×•×¨
- âœ… ××—×–×™×¨ ×›×œ ×”××™×¨×•×¢×™× ×©× ××¦××•

---

## ğŸ”— ××™× ×˜×’×¨×¦×™×•×ª

### 1. ××™× ×˜×’×¨×¦×™×” ×¢× Master Scoring System

**×–×¨×™××ª × ×ª×•× ×™×:**

```
Python Scoring Engine
  â†“
Master Scoring Calculation
  â†“
saveSymbolScores() â†’ Convex
  â†“
getTopRankedSymbols() â†’ Scanner
  â†“
TradePatternScanner.start()
```

**× ×ª×•× ×™× × ×“×¨×©×™×:**
- `symbol`: ×©× ×”×× ×™×”
- `direction`: LONG/SHORT
- `masterScore`: ×¦×™×•×Ÿ ×¡×•×¤×™
- `moduleScores`: ×¦×™×•× ×™ ××—×œ×§×•×ª

### 2. ××™× ×˜×’×¨×¦×™×” ×¢× Real-time Data

**×“×¨×™×©×•×ª:**
- ×—×™×‘×•×¨ ×œ-IBKR TWS/Gateway
- ×× ×•×™ ×œ× ×ª×•× ×™× ×‘×–××Ÿ ×××ª
- ×¢×“×›×•× ×™ candles ×¨×¦×™×¤×™×
- ××™× ×“×™×§×˜×•×¨×™× ×˜×›× ×™×™× (RSI, MACD, VWAP ×•×›×•')

**×¢×“×›×•× ×™× × ×“×¨×©×™×:**
- ×›×œ × ×¨ ×—×“×©
- ×©×™× ×•×™×™ ××—×™×¨ ××©××¢×•×ª×™×™×
- ×¢×“×›×•× ×™ ×•×•×œ×™×•×

### 3. ××™× ×˜×’×¨×¦×™×” ×¢× Execution Engine

**××™×¨×•×¢ ××•×¢×‘×¨:**

```typescript
PatternFoundEvent {
  symbol: "AAPL",
  strategyName: "DOUBLE_TOP",
  strategyDirection: "SHORT",
  patternState: {
    patternFound: true,
    entryPrice: 180.50,
    stopLoss: 185.00,
    metadata: { ... }
  },
  master: {
    symbol: "AAPL",
    direction: "SHORT",
    masterScore: 7.5,
    moduleScores: { ... }
  },
  detectedAt: "2024-12-15T10:30:00.000Z"
}
```

**×ª×”×œ×™×š ×‘-Execution Engine:**
1. ×§×‘×œ×ª PatternFoundEvent
2. ××™××•×ª ×ª× ××™ ×›× ×™×¡×”
3. ×—×™×©×•×‘ ×’×•×“×œ ×¤×•×–×™×¦×™×”
4. ×‘×“×™×§×ª × ×™×”×•×œ ×¡×™×›×•×Ÿ
5. ×‘×™×¦×•×¢ ×”×¢×¡×§×” (×× ×›×œ ×”×ª× ××™× ××ª×§×™×™××™×)

---

## ğŸ“Š ××¦×‘ × ×•×›×—×™ ×•×ª×›× ×•×Ÿ ×¢×ª×™×“×™

### âœ… ××” ×›×‘×¨ ×§×™×™×

1. **TradePatternScanner Class**
   - âœ… ××¨×›×™×˜×§×˜×•×¨×” ××œ××”
   - âœ… Direction filtering
   - âœ… Debounce system
   - âœ… Closed candle protection
   - âœ… Validation layers
   - âœ… Historical scanning

2. **IPatternStrategy Interface**
   - âœ… ×××©×§ ××•×’×“×¨
   - âœ… ×ª××™×›×” ×‘-LONG/SHORT/BOTH

3. **DoubleTopStrategy**
   - âœ… ××™××•×© ××œ×
   - âœ… Adapter pattern
   - âœ… ××™× ×˜×’×¨×¦×™×” ×¢× Scanner

4. **Type Definitions**
   - âœ… ×›×œ ×”-interfaces ××•×’×“×¨×™×
   - âœ… Type safety ××œ×

### ğŸš§ ××” ×—×¡×¨ (×˜×¨× ××™×•×©×)

1. **RealTimeDataClient Implementation**
   - âŒ ×—×™×‘×•×¨ ×œ-IBKR ×˜×¨× ×§×™×™×
   - âŒ Subscription management
   - âŒ × ×ª×•× ×™× ×‘×–××Ÿ ×××ª

2. **MasterScoringClient Implementation**
   - âŒ ×—×™×‘×•×¨ ×œ-Python Scoring Engine
   - âŒ ×§×¨×™××” ×-Convex
   - âŒ Caching mechanism

3. **××¡×˜×¨×˜×’×™×•×ª × ×•×¡×¤×•×ª**
   - âŒ Gap Up Strategy
   - âŒ Breakout Strategy
   - âŒ Reversal Strategies

4. **Logging System**
   - âŒ ×™×™×©×•× ScannerLogger ××œ×
   - âŒ ×œ×•×’×™× ××•×‘× ×™×
   - âŒ × ×™×˜×•×¨ ×•×‘×™×§×•×¨×ª

5. **Error Handling**
   - âŒ Retry logic
   - âŒ Error recovery
   - âŒ Fallback mechanisms

6. **Performance Optimization**
   - âŒ Caching ×©×œ ×ª×•×¦××•×ª
   - âŒ Batch processing
   - âŒ Resource management

### ğŸ“… ×ª×›× ×•×Ÿ ×¢×ª×™×“×™

#### ×©×œ×‘ 1: ×—×™×‘×•×¨×™× ×‘×¡×™×¡×™×™×
- [ ] RealTimeDataClient ×¢× IBKR
- [ ] MasterScoringClient ×¢× Convex
- [ ] ×‘×“×™×§×•×ª ××™× ×˜×’×¨×¦×™×”

#### ×©×œ×‘ 2: ××¡×˜×¨×˜×’×™×•×ª × ×•×¡×¤×•×ª
- [ ] Gap Up Strategy
- [ ] Breakout Strategy
- [ ] Double Bottom Strategy

#### ×©×œ×‘ 3: ×©×™×¤×•×¨×™ ×‘×™×¦×•×¢×™×
- [ ] Caching layer
- [ ] Optimized subscriptions
- [ ] Resource pooling

#### ×©×œ×‘ 4: × ×™×˜×•×¨ ×•×œ×•×’×™×
- [ ] Logging infrastructure
- [ ] Performance metrics
- [ ] Alert system

---

## ğŸ’¡ ×“×•×’×××•×ª ×©×™××•×©

### ×“×•×’××” 1: ××ª×—×•×œ ×‘×¡×™×¡×™

```typescript
import { TradePatternScanner } from "@/lib/scanner/trade-pattern-scanner";
import { DoubleTopStrategy } from "@/lib/strategies/double-top";

// ×™×¦×™×¨×ª ××¡×˜×¨×˜×’×™×”
const doubleTopStrategy = new DoubleTopStrategy(config);

// ×™×¦×™×¨×ª ×¡×•×¨×§
const scanner = new TradePatternScanner(
  masterClient,      // ×××©×§ ×œ-Master Scoring
  dataClient,        // ×××©×§ ×œ× ×ª×•× ×™× ×‘×–××Ÿ ×××ª
  [doubleTopStrategy], // ×¨×©×™××ª ××¡×˜×¨×˜×’×™×•×ª
  {
    minMasterScore: 6.0,
    maxSymbolsToScan: 20,
    enableDirectionFilter: true,
    debounceMs: 2000,
    requireClosedCandle: false
  },
  (event) => {
    // ×˜×™×¤×•×œ ×‘×”×ª×¨××”
    console.log("Pattern found!", event);
    executionEngine.handlePatternFound(event);
  },
  logger // ××•×¤×¦×™×•× ×œ×™
);

// ×”×¤×¢×œ×”
await scanner.start();
```

### ×“×•×’××” 2: Backtest ×¢×œ × ×ª×•× ×™× ×”×™×¡×˜×•×¨×™×™×

```typescript
// ×”×›× ×ª × ×ª×•× ×™×
const historicalData = {
  symbol: "AAPL",
  candles: [...], // × ×¨×•×ª ×”×™×¡×˜×•×¨×™×™×
  indicators: {...} // ××™× ×“×™×§×˜×•×¨×™×
};

// ×¡×¨×™×§×” ×”×™×¡×˜×•×¨×™×ª
const events = await scanner.scanHistorical(
  historicalData.symbol,
  historicalData.candles,
  historicalData.indicators,
  {
    direction: "SHORT",
    masterScore: 7.5
  }
);

// × ×™×ª×•×— ×”×ª×•×¦××•×ª
events.forEach(event => {
  console.log(`Found ${event.strategyName} on ${event.symbol}`);
});
```

### ×“×•×’××” 3: Batch Backtest

```typescript
// ×”×›× ×ª batch
const batch = [
  { symbol: "AAPL", candles: [...], indicators: {...} },
  { symbol: "GOOGL", candles: [...], indicators: {...} },
  { symbol: "MSFT", candles: [...], indicators: {...} }
];

// Master overrides
const masterOverrides = {
  "AAPL": { direction: "SHORT", masterScore: 7.5 },
  "GOOGL": { direction: "LONG", masterScore: 8.2 }
};

// ×¡×¨×™×§×” ××¨×•×‘×ª ×× ×™×•×ª
const allEvents = await scanner.scanHistoricalBatch(batch, masterOverrides);

// ×¡×™× ×•×Ÿ ×œ×¤×™ ××¡×˜×¨×˜×’×™×”
const doubleTopEvents = allEvents.filter(e => e.strategyName === "DOUBLE_TOP");
```

---

## ğŸ“ˆ ××“×“×™ ×‘×™×¦×•×¢×™×

### ××˜×¨×™×§×•×ª ×—×©×•×‘×•×ª

1. **Detection Rate**
   - ×›××” ×ª×‘× ×™×•×ª ××–×•×”×•×ª ×‘×©×¢×”
   - ×™×—×¡ ×‘×™×Ÿ false positives ×œ-true positives

2. **Latency**
   - ×–××Ÿ ××–×™×”×•×™ ×¢×“ ×”×ª×¨××”
   - ×–××Ÿ ×¢×“×›×•×Ÿ ×× ×•×™

3. **Resource Usage**
   - ×¦×¨×™×›×ª CPU
   - ×¦×¨×™×›×ª ×–×™×›×¨×•×Ÿ
   - ××¡×¤×¨ subscriptions ×¤×¢×™×œ×™×

4. **Accuracy**
   - ××—×•×– ×ª×‘× ×™×•×ª ×©×”×•×‘×™×œ×• ×œ×¢×¡×§×”
   - ××—×•×– ×ª×‘× ×™×•×ª ×¨×•×•×—×™×•×ª

---

## ğŸ”’ ××‘×˜×—×” ×•×™×¦×™×‘×•×ª

### ×× ×’× ×•× ×™ ×”×’× ×”

1. **Input Validation**
   - ××™××•×ª ×›×œ ×”× ×ª×•× ×™× ×”× ×›× ×¡×™×
   - ×‘×“×™×§×ª ××‘× ×” × ×ª×•× ×™×

2. **Error Handling**
   - Try-catch ×‘×›×œ ×”×¨××•×ª
   - Continuation ×¢×œ ×©×’×™××•×ª

3. **Resource Management**
   - × ×™×”×•×œ subscriptions
   - × ×™×§×•×™ resources

4. **Anti-Spam**
   - Debounce mechanism
   - Rate limiting

---

## ğŸ“š ××¡××›×™ ×¢×–×¨ × ×•×¡×¤×™×

- `docs/TRADE_ROUTER_COMPLETE_DOCUMENTATION.md` - ×ª×™×¢×•×“ ×× ×•×¢ ×”×‘×™×¦×•×¢
- `docs/SCORING_SYSTEM_WEIGHTS_DOCUMENTATION.md` - ×ª×™×¢×•×“ ××¢×¨×›×ª ×”× ×™×§×•×“
- `lib/scanner/trade-pattern-scanner.ts` - ×§×•×“ ×”××§×•×¨
- `lib/strategies/double-top.ts` - ×“×•×’××ª ××¡×˜×¨×˜×’×™×”

---

**×¡×•×£ ×”×“×•×—**

